let recognition;
let finalTranscript = '';
let lastFinalResult = '';

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = 'hi-IN';

  recognition.onresult = (event) => {
    let interim = '';
    for (let i = event.resultIndex; i < event.results.length; i++) {
      const transcript = event.results[i][0].transcript.trim();

      if (event.results[i].isFinal) {
        // Prevent duplicates by checking last added line
        if (transcript !== lastFinalResult) {
          finalTranscript += transcript + '\n';
          lastFinalResult = transcript;
        }
      } else {
        interim += transcript;
      }
    }
    transcriptDiv.innerText = finalTranscript + interim;
  };

  recognition.onerror = (e) => {
    transcriptDiv.innerText += `\nâš ï¸ à¤¤à¥à¤°à¥à¤Ÿà¤¿: ${e.error}`;
  };

  startBtn.onclick = () => {
    lastFinalResult = '';
    recognition.start();
    transcriptDiv.innerText += '\nðŸŽ¤ à¤¸à¥à¤¨à¤¨à¤¾ à¤¶à¥à¤°à¥‚...\n';
  };

  stopBtn.onclick = () => {
    recognition.stop();
    transcriptDiv.innerText += '\nðŸ›‘ à¤¸à¥à¤¨à¤¨à¤¾ à¤¬à¤‚à¤¦...\n';
  };

  clearBtn.onclick = () => {
    finalTranscript = '';
    lastFinalResult = '';
    transcriptDiv.innerText = '';
  };
}
