<script>
let recognition;
let finalTranscript = '';
let lastFinalResult = '';

const transcriptDiv = document.getElementById('transcript');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const clearBtn = document.getElementById('clearBtn');

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = 'hi-IN';

  recognition.onresult = (event) => {
    let interim = '';
    for (let i = event.resultIndex; i < event.results.length; i++) {
      const transcript = event.results[i][0].transcript.trim();

      if (event.results[i].isFinal) {
        // Prevent duplicates
        if (transcript !== lastFinalResult) {
          finalTranscript += transcript + '\n';
          lastFinalResult = transcript;
        }
      } else {
        interim += transcript;
      }
    }
    transcriptDiv.innerText = finalTranscript + interim;
  };

  recognition.onerror = (e) => {
    transcriptDiv.innerText += `\nтЪая╕П рддреНрд░реБрдЯрд┐: ${e.error}`;
  };

  startBtn.onclick = () => {
    lastFinalResult = '';
    recognition.start();
    transcriptDiv.innerText += '\nЁЯОд рд╕реБрдирдирд╛ рд╢реБрд░реВ...\n';
  };

  stopBtn.onclick = () => {
    recognition.stop();
    transcriptDiv.innerText += '\nЁЯЫС рд╕реБрдирдирд╛ рдмрдВрдж...\n';
  };

  clearBtn.onclick = () => {
    finalTranscript = '';
    lastFinalResult = '';
    transcriptDiv.innerText = '';
  };
} else {
  transcriptDiv.innerText = "тЪая╕П рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ред";
  startBtn.disabled = true;
  stopBtn.disabled = true;
  clearBtn.disabled = true;
}
</script>
