<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>рд╣рд┐рдВрджреА рдЖрд╡рд╛рдЬрд╝ рд╕реЗ рд▓рд┐рдЦрд╛рд╡рдЯ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f0f0f0;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    #transcript {
      background: white;
      padding: 1rem;
      font-size: 1.5rem;
      border: 1px solid #ccc;
      min-height: 150px;
      white-space: pre-wrap;
      line-height: 2rem;
    }
    button {
      margin-top: 1rem;
      padding: 1rem 2rem;
      font-size: 1rem;
      margin-right: 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #startBtn { background-color: #28a745; color: white; }
    #stopBtn { background-color: #dc3545; color: white; }
    #clearBtn { background-color: #ffc107; color: black; }
    
    .warning {
      background: #fff3cd;
      color: #856404;
      padding: 1rem;
      border: 1px solid #ffeaa7;
      border-radius: 5px;
      margin-bottom: 1rem;
    }
    
    .browser-info {
      font-size: 0.9rem;
      color: #666;
      margin-top: 1rem;
    }

  </style>
</head>
<body>
  <h1>ЁЯОд рд╣рд┐рдВрджреА рдЖрд╡рд╛рдЬрд╝ рд╕реЗ рд▓рд┐рдЦрд╛рд╡рдЯ</h1>
  
  <div id="browserWarning" class="warning" style="display: none;">
    тЪая╕П рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рдХрд╛ рдкреВрд░рд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ред рдмреЗрд╣рддрд░ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд▓рд┐рдП рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░ Chrome рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
  </div>
  

  
  <div id="transcript">рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "рд╕реБрдирдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ" рджрдмрд╛рдПрдВтАж</div>
  <button id="startBtn">ЁЯФК рд╕реБрдирдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ</button>
  <button id="stopBtn">тЬЛ рд░реЛрдХреЗрдВ</button>
  <button id="clearBtn">ЁЯЧСя╕П рд╕рд╛рдлрд╝ рдХрд░реЗрдВ</button>
  
  <div class="browser-info" id="browserInfo"></div>
  
  <script>
    let recognition;
    let finalTranscript = '';
    let lastProcessedIndex = -1;
    let isRecognizing = false;
    
    const transcriptDiv = document.getElementById('transcript');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const clearBtn = document.getElementById('clearBtn');

    const browserWarning = document.getElementById('browserWarning');
    const browserInfo = document.getElementById('browserInfo');
    
    // Detect browser and show appropriate messages
    function detectBrowser() {
      const userAgent = navigator.userAgent;
      const isIOS = /iPad|iPhone|iPod/.test(userAgent);
      const isAndroid = /Android/.test(userAgent);
      const isChrome = /Chrome/.test(userAgent);
      const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
      const isFirefox = /Firefox/.test(userAgent);
      
      let browserMsg = '';
      
      if (isIOS && isChrome) {
        browserMsg = 'ЁЯУ▒ iOS Chrome - рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИред Safari рдореЗрдВ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред';
        browserWarning.style.display = 'block';
      } else if (isIOS && isSafari) {
        browserMsg = 'ЁЯУ▒ iOS Safari - рд╕реАрдорд┐рдд рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рд╕рдорд░реНрдердиред';
        browserWarning.style.display = 'block';
      } else if (isAndroid && isChrome) {
        browserMsg = 'ЁЯУ▒ Android Chrome - рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рд╕рдорд░реНрдерд┐рдд рд╣реИред';
      } else if (isChrome) {
        browserMsg = 'ЁЯТ╗ Desktop Chrome - рдкреВрд░реНрдг рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рд╕рдорд░реНрдердиред';
      } else if (isFirefox) {
        browserMsg = 'ЁЯжК Firefox - рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИред';
        browserWarning.style.display = 'block';
      } else {
        browserMsg = 'ЁЯМР ' + userAgent.split(' ')[0];
      }
      
      browserInfo.textContent = browserMsg;
    }
    
    // Initialize speech recognition
    function initSpeechRecognition() {
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
      } else if ('SpeechRecognition' in window) {
        recognition = new SpeechRecognition();
      } else {
        transcriptDiv.innerText = "тЪая╕П рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ред\n\nрд╕реБрдЭрд╛рд╡:\n- рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░ Chrome рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n- Android рдкрд░ Chrome рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n- iOS рдкрд░ Safari рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ";
        startBtn.disabled = true;
        stopBtn.disabled = true;
        browserWarning.style.display = 'block';
        return false;
      }
      
      // Enhanced recognition settings for better Hindi support
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'hi-IN';
      recognition.maxAlternatives = 1;
      
      // Additional settings for better accuracy
      if (recognition.serviceURI !== undefined) {
        recognition.serviceURI = 'wss://www.google.com/speech-api/v2/recognize';
      }
      
      recognition.onstart = () => {
        isRecognizing = true;
        startBtn.disabled = true;
        stopBtn.disabled = false;
        transcriptDiv.innerText = finalTranscript + '\nЁЯОд рд╕реБрдирдирд╛ рд╢реБрд░реВ...\n';
      };
      
      recognition.onend = () => {
        isRecognizing = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
        if (finalTranscript.trim()) {
          transcriptDiv.innerText = finalTranscript + '\nЁЯЫС рд╕реБрдирдирд╛ рдмрдВрдж...\n';
        }
      };
      
      recognition.onerror = (event) => {
        isRecognizing = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
        
        let errorMsg = '';
        switch(event.error) {
          case 'network':
            errorMsg = 'рдиреЗрдЯрд╡рд░реНрдХ рддреНрд░реБрдЯрд┐ - рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рдЬрд╛рдВрдЪреЗрдВ';
            break;
          case 'not-allowed':
            errorMsg = 'рдорд╛рдЗрдХреНрд░реЛрдлрд╝реЛрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ';
            break;
          case 'no-speech':
            errorMsg = 'рдХреЛрдИ рдЖрд╡рд╛рдЬрд╝ рдирд╣реАрдВ рд╕реБрдирд╛рдИ рджреА';
            break;
          case 'audio-capture':
            errorMsg = 'рдорд╛рдЗрдХреНрд░реЛрдлрд╝реЛрди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ';
            break;
          case 'service-not-allowed':
            errorMsg = 'рд╕реЗрд╡рд╛ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ - HTTPS рдЖрд╡рд╢реНрдпрдХ';
            break;
          default:
            errorMsg = `рддреНрд░реБрдЯрд┐: ${event.error}`;
        }
        
        transcriptDiv.innerText = finalTranscript + `\nтЪая╕П ${errorMsg}\n`;
      };
      
      recognition.onresult = (event) => {
        let interim = '';
        
        // Process only new results
        for (let i = Math.max(event.resultIndex, lastProcessedIndex + 1); i < event.results.length; i++) {
          const result = event.results[i];
          const transcript = result[0].transcript.trim();
          
          if (result.isFinal && transcript) {
            finalTranscript += transcript + ' ';
            lastProcessedIndex = i;
          } else if (!result.isFinal && transcript) {
            interim += transcript;
          }
        }
        
        // Update display
        const currentText = finalTranscript + (interim ? `[${interim}]` : '');
        transcriptDiv.innerText = currentText || 'рдмреЛрд▓рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ...';
      };
      
      return true;
    }
    
    // Event listeners
    startBtn.onclick = () => {
      if (!recognition) {
        if (!initSpeechRecognition()) return;
      }
      
      if (!isRecognizing) {
        lastProcessedIndex = -1;
        recognition.lang = 'hi-IN';
        
        try {
          recognition.start();
        } catch (e) {
          console.log('Recognition start error:', e);
          transcriptDiv.innerText = finalTranscript + '\nтЪая╕П рдЖрд╡рд╛рдЬрд╝ рдкрд╣рдЪрд╛рди рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛ рд╕рдХрд╛\n';
        }
      }
    };
    
    stopBtn.onclick = () => {
      if (recognition && isRecognizing) {
        recognition.stop();
      }
    };
    
    clearBtn.onclick = () => {
      finalTranscript = '';
      lastProcessedIndex = -1;
      transcriptDiv.innerText = 'рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "рд╕реБрдирдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ" рджрдмрд╛рдПрдВтАж';
    };

    
    // Initialize on page load
    detectBrowser();
    initSpeechRecognition();
    
    // Disable stop button initially
    stopBtn.disabled = true;
  </script>
</body>
</html>
